# Auto-Save System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          SurveyDetail.jsx (Form Component)                â”‚   â”‚
â”‚  â”‚  - Auto-save timer (30s interval)                         â”‚   â”‚
â”‚  â”‚  - Manual save button                                     â”‚   â”‚
â”‚  â”‚  - Status indicators (Online/Offline/Auto-saving)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                    â”‚
             â”‚ Every 30s                          â”‚ On "Save" click
             â”‚                                    â”‚
             â–¼                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  autoSaveDraft()   â”‚            â”‚   manualSave()        â”‚
    â”‚  (surveyService)   â”‚            â”‚   (surveyService)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                  â”‚
              â”‚                                  â”‚
              â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   saveDraft()        â”‚         â”‚   markAsFinal()          â”‚
    â”‚   (indexedDB)        â”‚         â”‚   (indexedDB)            â”‚
    â”‚   - is_draft: true   â”‚         â”‚   - is_draft: false      â”‚
    â”‚   - NO sync queue    â”‚         â”‚   - ADD to sync queue    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                 â”‚
               â–¼                                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
    â”‚   IndexedDB Storage  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚   (Local Browser)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ If online & not draft
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Sync Service           â”‚
    â”‚   - Every 60s            â”‚
    â”‚   - On network change    â”‚
    â”‚   - Skips drafts         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Only syncs is_draft: false
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Backend Server         â”‚
    â”‚   (FastAPI)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow States

### State 1: NEW SURVEY
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IndexedDB                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ survey_id: "SURVEY_1234..."                 â”‚
â”‚ village_name: "Example Village"             â”‚
â”‚ basic_info: {}                              â”‚
â”‚ is_draft: undefined                         â”‚
â”‚ synced: false                               â”‚
â”‚ last_auto_save: undefined                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Status: New, not edited yet
```

### State 2: AUTO-SAVED (30s after editing)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IndexedDB                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ survey_id: "SURVEY_1234..."                 â”‚
â”‚ village_name: "Example Village"             â”‚
â”‚ basic_info: { population: 5000 }            â”‚
â”‚ is_draft: true â—„â”€â”€ DRAFT FLAG               â”‚
â”‚ synced: false                               â”‚
â”‚ last_auto_save: "2025-11-01T10:30:00Z" â—„â”€â”€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Status: Draft, NOT synced to server
```

### State 3: MANUALLY SAVED (User clicked "Save Survey")
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IndexedDB                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ survey_id: "SURVEY_1234..."                 â”‚
â”‚ village_name: "Example Village"             â”‚
â”‚ basic_info: { population: 5000 }            â”‚
â”‚ is_draft: false â—„â”€â”€ FINALIZED               â”‚
â”‚ synced: false â—„â”€â”€ PENDING SYNC              â”‚
â”‚ last_auto_save: "2025-11-01T10:30:00Z"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Added to Sync Queue
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pending Sync Queue                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ action: "update"                            â”‚
â”‚ survey_id: "SURVEY_1234..."                 â”‚
â”‚ synced: false                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Status: Finalized, queued for sync
```

### State 4: SYNCED TO SERVER
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IndexedDB                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ survey_id: "SURVEY_1234..."                 â”‚
â”‚ village_name: "Example Village"             â”‚
â”‚ basic_info: { population: 5000 }            â”‚
â”‚ is_draft: false                             â”‚
â”‚ synced: true â—„â”€â”€ SYNCED                     â”‚
â”‚ synced_at: "2025-11-01T10:35:00Z" â—„â”€â”€       â”‚
â”‚ last_auto_save: "2025-11-01T10:30:00Z"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Synced successfully
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Server                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ survey_id: "SURVEY_1234..."                 â”‚
â”‚ village_name: "Example Village"             â”‚
â”‚ basic_info: { population: 5000 }            â”‚
â”‚ (No is_draft, last_auto_save fields)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Status: Fully synced
```

## Timeline Example

```
T=0s     User opens survey
         â””â”€â†’ Draft restored if exists

T=10s    User edits "population" field
         â””â”€â†’ formData updated in React state

T=30s    Auto-save timer triggers
         â””â”€â†’ autoSaveDraft() called
         â””â”€â†’ Saved to IndexedDB (is_draft: true)
         â””â”€â†’ NOT added to sync queue
         â””â”€â†’ "Auto-saved at 10:30:30"

T=45s    User edits "households" field
         â””â”€â†’ formData updated in React state

T=60s    Auto-save timer triggers again
         â””â”€â†’ autoSaveDraft() called
         â””â”€â†’ Updated in IndexedDB (is_draft: true)
         â””â”€â†’ "Auto-saved at 10:31:00"

T=75s    User clicks "Save Survey" button
         â””â”€â†’ manualSave() called
         â””â”€â†’ markAsFinal() sets is_draft: false
         â””â”€â†’ Added to sync queue
         â””â”€â†’ If online: Immediate sync to server
         â””â”€â†’ If offline: Queued for later sync
         â””â”€â†’ Toast: "Survey saved successfully!"

T=90s    Auto-save timer triggers
         â””â”€â†’ autoSaveDraft() called
         â””â”€â†’ Now is_draft: false (stays final)
         â””â”€â†’ Continues auto-saving

T=120s   Sync service runs (if online)
         â””â”€â†’ Checks pending sync queue
         â””â”€â†’ Finds finalized survey
         â””â”€â†’ Syncs to server
         â””â”€â†’ Marks as synced: true
         â””â”€â†’ Toast: "Survey synced to server"
```

## Offline/Online Scenario

```
ONLINE PHASE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=0s     User online, editing form
T=30s    Auto-save â†’ IndexedDB (draft)
T=60s    Auto-save â†’ IndexedDB (draft)
         
         âœ‚ï¸ Network disconnects
         
OFFLINE PHASE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=90s    Auto-save â†’ IndexedDB (draft) âœ… Still works!
T=120s   User clicks "Save Survey"
         â””â”€â†’ Saved locally (is_draft: false)
         â””â”€â†’ Added to sync queue
         â””â”€â†’ Toast: "Will sync when online"
T=150s   Auto-save â†’ IndexedDB âœ… Still works!
         
         ğŸ”Œ Network reconnects
         
ONLINE PHASE (RESUMED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=180s   Network online event detected
         â””â”€â†’ Sync triggered automatically
         â””â”€â†’ Pending surveys pushed to server
         â””â”€â†’ Toast: "Survey synced to server"
T=210s   Auto-save â†’ IndexedDB (now synced)
```

## Storage Locations

### IndexedDB Structure
```
SamparkDB (Database)
â”œâ”€â”€ surveys (Object Store)
â”‚   â”œâ”€â”€ Survey 1
â”‚   â”‚   â”œâ”€â”€ id: 1 (IndexedDB auto-increment)
â”‚   â”‚   â”œâ”€â”€ survey_id: "SURVEY_..."
â”‚   â”‚   â”œâ”€â”€ village_name: "..."
â”‚   â”‚   â”œâ”€â”€ basic_info: { ... }
â”‚   â”‚   â”œâ”€â”€ is_draft: true/false
â”‚   â”‚   â”œâ”€â”€ synced: true/false
â”‚   â”‚   â”œâ”€â”€ last_auto_save: "timestamp"
â”‚   â”‚   â””â”€â”€ synced_at: "timestamp"
â”‚   â””â”€â”€ Survey 2...
â”‚
â”œâ”€â”€ pendingSync (Object Store)
â”‚   â”œâ”€â”€ Sync Operation 1
â”‚   â”‚   â”œâ”€â”€ id: 1
â”‚   â”‚   â”œâ”€â”€ action: "update"
â”‚   â”‚   â”œâ”€â”€ survey_id: "..."
â”‚   â”‚   â”œâ”€â”€ data: { ... }
â”‚   â”‚   â”œâ”€â”€ synced: false
â”‚   â”‚   â””â”€â”€ timestamp: "..."
â”‚   â””â”€â”€ Sync Operation 2...
â”‚
â””â”€â”€ syncLogs (Object Store)
    â”œâ”€â”€ Log 1
    â”‚   â”œâ”€â”€ timestamp: "..."
    â”‚   â”œâ”€â”€ status: "success"
    â”‚   â””â”€â”€ details: { ... }
    â””â”€â”€ Log 2...
```

## Decision Flow Chart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Form Data Changed     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Wait 30 seconds       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auto-save triggered?  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚
   Yes              No (Manual save?)
    â”‚                â”‚
    â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Draft    â”‚    â”‚ Mark Final   â”‚
â”‚ Save     â”‚    â”‚ (is_draft=0) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â”‚                 â–¼
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚ Add to Sync  â”‚
     â”‚         â”‚ Queue        â”‚
     â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â”‚                â–¼
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚ Is Online?   â”‚
     â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚              â”‚
     â”‚        Yes            No
     â”‚         â”‚              â”‚
     â”‚         â–¼              â–¼
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ Sync    â”‚    â”‚ Queue   â”‚
     â”‚   â”‚ Now     â”‚    â”‚ for     â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Later   â”‚
     â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                       
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ IndexedDB    â”‚
      â”‚ Updated      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Differences: Draft vs Final

| Aspect | Draft (Auto-save) | Final (Manual save) |
|--------|------------------|---------------------|
| Trigger | 30s timer | User clicks "Save" |
| Field | `is_draft: true` | `is_draft: false` |
| Sync Queue | âŒ Not added | âœ… Added |
| Server Sync | âŒ Never | âœ… When online |
| Purpose | Prevent data loss | Persist changes |
| Frequency | Every 30s | On demand |

This architecture ensures data safety while minimizing server load!
